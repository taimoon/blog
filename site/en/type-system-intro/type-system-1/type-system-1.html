<html lang="en">
  <head>
    <meta date="2024-10-30"/>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width" initial-scale="1.0"/>
    <link rel="stylesheet" href="/style.css"/>
    <title>Type System 1</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"/>
    <script id="ajax-highlight" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
              document.addEventListener('DOMContentLoaded', function() {
                    var element = document.getElementById('ajax-highlight');
                    if (element) {
                        hljs.highlightAll();
                    }
                });
             </script>
    <script id="MathJax-script-forreal" defer="" src="https://cdn.mathjax.org/mathjax/2.7-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
        tex2jax: {
        inlineMath: [ ['$','$'] ],
        processEscapes: true
        }
    });
    </script>
  </head>
  <header>
    <nav>
      <ul>
        <li>
          <a href="/index.html">home</a>
        </li>
        <li>
          <a href="/en/about/about.html">about</a>
        </li>
        <li>
          <a href="/zh/type-system-intro/type-system-1/类型应用入门一.html">中文</a>
        </li>
      </ul>
    </nav>
  </header>
  <main><p>date: 2024-10-30</p><h1>Type System 1</h1>
<h1>How to type json?</h1>
<p>These are valid json</p>
<pre><code class="language-json">3
</code></pre>
<p>number (either integer or float)</p>
<pre><code class="language-json">true
</code></pre>
<p>boolean</p>
<pre><code class="language-json">'patchouli'
</code></pre>
<p>string</p>
<pre><code class="language-json">null
</code></pre>
<p>null</p>
<pre><code class="language-json">[11,13,17]
</code></pre>
<p>array</p>
<pre><code>{
    'jan' : 1,
    'feb' : 2,
    'mac' : 3
}
</code></pre>
<p>javascript object (or named-value pair)</p>
<p>But there are at least 6 types that describe json type.
We may use <code>Union</code> to describe the either-ness type.
When written in python, it will be like</p>
<pre><code class="language-py">json_ty = int|float|bool|None|str|list|dict
</code></pre>
<h1>Options</h1>
<p>Some functions might return either valid result or null as non-result/missing.
Its type can be described as <code>T|None</code>.</p>
<p>For example,</p>
<pre><code class="language-py">def copy_file(input_path: str, output_path: str|None = None) -&gt; None:
    '''
    Example Usage
    ---
    ```
    copy_file('foo.txt', 'bar.txt')
    copy_file('foo.txt') ==&gt; copy_file('foo.txt','foo_copy.txt')
    ```
    '''
    import os
    if output_path is None:
        wkdir, file_name = os.path.split(input_path)
        file_stem, file_ext = os.path.splitext(file_name)
        output_path = os.path.join(wkdir, file_stem + '_copy' + file_ext)

    with open(input_path, 'rb') as inp:
        with open(output_path, 'wb+') as out:
            out.write(inp.read())
</code></pre>
<p>The usage of <code>T|None</code> is so frequent, that python provides <code>Optional</code> shorthand</p>
<pre><code class="language-py">from typing import Optional
def copy_file(input_path: str, output_path: Optional[str] = None) -&gt; None:
    '''
    Example Usage
    ---
    ```
    copy_file('foo.txt', 'bar.txt')
    copy_file('foo.txt') ==&gt; copy_file('foo.txt','foo_copy.txt')
    ```
    '''
    import os
    if output_path is None:
        wkdir, file_name = os.path.split(input_path)
        file_stem, file_ext = os.path.splitext(file_name)
        output_path = os.path.join(wkdir, file_stem + '_copy' + file_ext)

    with open(input_path, 'rb') as inp:
        with open(output_path, 'wb+') as out:
            out.write(inp.read())
</code></pre>
<h1>Civilised use of union is tagged union</h1>
<p>Reference: <a href="https://en.wikipedia.org/wiki/Tagged_union">https://en.wikipedia.org/wiki/Tagged_union</a></p>
<p>Make sure that write the program to handle every type/case as described in union.</p>
<p>Some programming language systems may check whether your program handled each case as described in union.
The exhaustive check is a feature in static programming language.
We can write similar pattern in python, for example</p>
<pre><code class="language-py">def calc(e: bool|int|list) -&gt; int|bool:
    match e:
        case int():
            return e
        case bool():
            return e
        case ['-', e1, e2]:
            return calc(e1) + calc(e2)
        case ['if', e1, e2 ,e3]:
            if calc(e1) is False:
                return calc(e3)
            else:
                return calc(e2)
        case [*_]:
            raise NotImplementedError('calc','unknown form' e)
        case _:
            raise NotImplementedError('calc','unknown input', e)
</code></pre>
<h1>Polymorphism</h1>
<p>The program below return larger from two numbers.</p>
<pre><code class="language-py">def max(x: int|float, y: int|float) -&gt; int|float:
    if x &lt; y:
        return y
    else:
        return x
</code></pre>
<p>The notion of <code>max</code> works for a lot of thing such as integer, rational number, real number and lexicographics. 
When something works for multiple types, it is polymorphic.</p>
<p>There are several implementations of polymorphism such as</p>
<ul>
<li>subtype polymorphism (e.g.: inheritance)</li>
<li>parametric polymorphism (e.g.: C++ templates, rust generics)</li>
<li>method dispatch (e.g.: Julia dynamic dispatch)</li>
<li>duck typing (e.g.: Python)</li>
<li>tagged union</li>
</ul>
<h1>Advance : Generics</h1>
<pre><code class="language-py">from typing import Callable
def compose(f: Callable[[int], int], g: Callable[[int], int]) -&gt; Callable[[int], int]:
    def wrapped(x: int) -&gt; int:
        return f(g(x))
    return wrapped

def sqr(x: int) -&gt; int:
    return x * x

f = compose(sqr,sqr)
print(f(2)) # 16
</code></pre>
<p>As above, we have implemented a function wrapper that make two functions into one function.
But the <code>compose</code> function is generally applicable for other type of functions such as</p>
<pre><code class="language-py">str.strip   : ((str) -&gt; str)
str.__len__ : ((str) -&gt; int)
---
compose(str.strip, str.__len__) : ((str) -&gt; int)

sqr : ((int) -&gt; int)
---
compose(compose(str.strip, str.len),str.__len__) : ((str) -&gt; int)
</code></pre>
<p>To better describe this, we can add generics to type system, it works like substitute type variable with type. 
After python version 3.12, it can be written as below</p>
<pre><code class="language-py">from typing import Callable
def identity[X](x: X) -&gt; X:
    return x

def compose[X, Y, Z](f: Callable[[X], Y], g: Callable[[Y], Z]) -&gt; Callable[[X], Z]:
    def wrapped(x: X) -&gt; Z:
        return f(g(x))
    return wrapped


def sqr(x: int) -&gt; int:
    return x * x

x: int = identity(10)
y: str = identity('s')
f: Callable[[int], int] = compose(sqr,sqr)
g: Callable[[str], int] = compose(str.strip, str.__len__)
h: Callable[[str], int] = compose(compose(str.strip, str.__len__),sqr)
H: Callable[[str], int] = compose(compose(str.strip, str.__len__),compose(sqr,identity))
</code></pre>
<h1>Advance : Recursive Type</h1>
<p>However, previous description does not describe the json fully. 
The javascript object is a collection of name-value pairs 
whose name must be string but values can be any one of json type. 
In addition, array here allow any one of json type. For example</p>
<pre><code>{
    'jan' : 1,
    'feb' : '2',
    'mac' : 3,
    'foo' : false,
    'bar' : null,
    'omg' : {
            'jan' : 1,
            'feb' : 2,
            'mac' : 3
        },
    'basic' : [1,true,false,null]
}
</code></pre>
<p>In python, it can be rewritten as</p>
<pre><code class="language-py">type json_ty = int|float|bool|None|str|list[json_ty]|dict[str,json_ty]
</code></pre>
<p><a href="https://ocaml.org/docs/basic-data-types#recursive-variants">https://ocaml.org/docs/basic-data-types#recursive-variants</a></p>
<p>In ocaml, it can be written as</p>
<pre><code>type json =
  | Null
  | Bool of bool
  | Int of int
  | Float of float
  | String of string
  | Array of json list
  | Object of (string * json) list;;
</code></pre></main>
  <footer>
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">COPYRIGHT NOTICE: CC BY-SA 4.0</a>
    <a href="https://github.com/taimoon">github</a>
  </footer>
</html>
